!function(e){function t(n){if(i[n])return i[n].exports;var r=i[n]={exports:{},id:n,loaded:!1};return e[n].call(r.exports,r,r.exports,t),r.loaded=!0,r.exports}var i={};return t.m=e,t.c=i,t.p="",t(0)}([function(e,t,i){"use strict";function n(e,t){return{status:"error",src:t,message:e,timestamp:Date.now()}}var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},a=i(2);if("undefined"==typeof AFRAME)throw"Component attempted to register before AFRAME was available.";var o=AFRAME.utils.srcLoader.parseUrl,s=AFRAME.utils.debug;s.enable("shader:video:warn");var u=s("shader:video:warn"),d=s("shader:video:debug"),c={};AFRAME.registerShader("video",{schema:{color:{type:"color"},fog:{"default":!0},src:{"default":null},autoplay:{"default":!0},preload:{"default":!0},muted:{"default":!0},loop:{"default":!0},fps:{"default":60},volume:{"default":void 0},pause:{"default":!1}},init:function(e){return d("init",e),this.__cnv=document.createElement("canvas"),this.__cnv.width=2,this.__cnv.height=2,this.__ctx=this.__cnv.getContext("2d"),this.__texture=new THREE.Texture(this.__cnv),this.__reset(),this.material=new THREE.MeshBasicMaterial({map:this.__texture}),this.el.sceneEl.addBehavior(this),this.material},update:function(e){return d("update",e),this.__updateMaterial(e),this.__updateTexture(e),this.material},tick:function(e){d("tick"),!this.__paused&&this.__canvasVideo&&this.__canvasVideo.tick()},__updateMaterial:function(e){var t=this.material,i=this.__getMaterialData(e);Object.keys(i).forEach(function(e){t[e]=i[e]})},__getMaterialData:function(e){return{fog:e.fog,color:new THREE.Color(e.color)}},__setTexure:function(e){d("__setTexure",e),"error"===e.status?(u("Error: "+e.message+"\nsrc: "+e.src),this.__reset()):"success"===e.status&&e.src!==this.__textureSrc&&(this.__reset(),this.__ready(e))},__updateTexture:function(e){var t=e.src,i=e.autoplay,n=(e.muted,e.volume,e.loop,e.fps),r=e.pause;"boolean"==typeof i?this.__autoplay=i:"undefined"==typeof i&&(this.__autoplay=this.schema.autoplay["default"]),this.__autoplay&&this.__frames&&this.play(),"boolean"==typeof preload?this.__preload=preload:"undefined"==typeof preload&&(this.__preload=this.schema.preload["default"]),r?this.pause():this.play(),this.__muted=!0,this.__volume=void 0,this.__loop=!0,this.__fps=n||this.schema.fps["default"],t?this.__validateSrc(t,this.__setTexure.bind(this)):this.__reset()},__validateSrc:function(e,t){var i=o(e);if(i)return void this.__getVideoSrc({src:i,cb:t});var a=void 0,s=this.__validateAndGetQuerySelector(e);if(s&&"object"===("undefined"==typeof s?"undefined":r(s))){if(s.error)a=s.error;else{var u=s.tagName.toLowerCase();if("video"===u){e=s.src;var d=s.getAttribute("type");this.__getVideoSrc({src:e,type:d,cb:t,el:s})}else a="img"===u?"For <"+u+"> element, please use `shader:flat`":"For <"+u+"> element, please use `aframe-html-shader`"}a&&!function(){var i=c[e],r=n(a,e);i&&i.callbacks?i.callbacks.forEach(function(e){return e(r)}):t(r),c[e]=r}()}},__getVideoSrc:function(){for(var e=arguments.length,t=Array(e),i=0;e>i;i++)t[i]=arguments[i];t=t[0];var o=t.src,s=t.type,u=t.cb,d=t.el;if(o!==this.__textureSrc){var l=c[o];if(l&&l.callbacks){if(l.src)return void u(l);if(l.callbacks)return void l.callbacks.push(u)}else l=c[o]={callbacks:[]},l.callbacks.push(u);var v={autoplay:this.__autoplay,preload:this.__preload,muted:this.__muted,volume:this.__volume,loop:this.__loop,fps:this.__fps,canvas:this.__cnv,context:this.__ctx,render:this.__render.bind(this),element:d};(0,a.inlineVideo)({src:o,type:s,opt:v,cb:function(e,t){if(e){var i=function(){var t=n(e,o);return l.callbacks&&(l.callbacks.forEach(function(e){return e(t)}),c[o]=t),{v:void 0}}();if("object"===("undefined"==typeof i?"undefined":r(i)))return i.v}var a={status:"success",src:o,canvasVideo:t,timestamp:Date.now()};l.callbacks&&(l.callbacks.forEach(function(e){return e(a)}),c[o]=a)}})}},__validateAndGetQuerySelector:function(e){try{var t=document.querySelector(e);return t?t:{error:"No element was found matching the selector"}}catch(i){return{error:"no valid selector"}}},__addPublicFunctions:function(){this.el.shader={play:this.play.bind(this),pause:this.pause.bind(this),togglePlayback:this.togglePlayback.bind(this),paused:this.paused.bind(this),nextFrame:this.nextFrame.bind(this)}},pause:function(){d("pause"),this.__paused=!0,this.__canvasVideo&&this.__canvasVideo.pause()},play:function(){d("play"),this.__paused=!1,this.__canvasVideo&&this.__canvasVideo.play()},togglePlayback:function(){this.paused()?this.play():this.pause()},paused:function(){return this.__paused},__clearCanvas:function(){this.__ctx.clearRect(0,0,this.__width,this.__height),this.__texture.needsUpdate=!0},__draw:function(e){this.__ctx.drawImage(e,0,0,this.__width,this.__height),this.__texture.needsUpdate=!0},__render:function(e){this.__clearCanvas(),this.__draw(e)},__ready:function(e){var t=e.src,i=e.canvasVideo;d("__ready"),this.__textureSrc=t,this.__width=this.__cnv.width,this.__height=this.__cnv.height,this.__canvasVideo=i,this.__autoplay?this.play():this.pause()},__reset:function(){this.pause(),this.__clearCanvas(),this.__textureSrc=null}})},function(e,t){function i(){d&&o&&(d=!1,o.length?u=o.concat(u):c=-1,u.length&&n())}function n(){if(!d){var e=setTimeout(i);d=!0;for(var t=u.length;t;){for(o=u,u=[];++c<t;)o&&o[c].run();c=-1,t=u.length}o=null,d=!1,clearTimeout(e)}}function r(e,t){this.fun=e,this.array=t}function a(){}var o,s=e.exports={},u=[],d=!1,c=-1;s.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)t[i-1]=arguments[i];u.push(new r(e,t)),1!==u.length||d||setTimeout(n,0)},r.prototype.run=function(){this.fun.apply(null,this.array)},s.title="browser",s.browser=!0,s.env={},s.argv=[],s.version="",s.versions={},s.on=a,s.addListener=a,s.once=a,s.off=a,s.removeListener=a,s.removeAllListeners=a,s.emit=a,s.binding=function(e){throw new Error("process.binding is not supported")},s.cwd=function(){return"/"},s.chdir=function(e){throw new Error("process.chdir is not supported")},s.umask=function(){return 0}},function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var r=i(7),a=n(r),o=i(3),s=n(o),u=AFRAME.utils.debug;u.enable("shader:video:warn");var d=u("shader:video:warn"),c=(u("shader:video:debug"),/i(Pad|Phone)/i.test(navigator.userAgent));t.inlineVideo=function(){function e(e){if(e)return d(e),void h("Somehow there is error during loading video");g.width=THREE.Math.nearestPowerOfTwo(x.videoWidth),g.height=THREE.Math.nearestPowerOfTwo(x.videoHeight),c&&(x.addEventListener("timeupdate",r,!1),k&&k.addEventListener("ended",function(){m&&(k.currentTime=0)},!1)),A=x.duration;var a={play:t,pause:i,tick:n,canvas:g,video:x,audio:k,fallback:c};h(null,a)}function t(){w=Date.now(),k&&k.play(),c||x.play()}function i(){k&&k.pause(),c||x.pause()}function n(){if(!c)return r();var e=Date.now();E=(e-w)/1e3,E>=1e3/_/1e3&&(c&&(k?x.currentTime=k.currentTime:x.currentTime=x.currentTime+E),w=e),c&&!k&&Math.abs(x.currentTime-A)<.1&&m&&(x.currentTime=0)}function r(){y(x)}for(var o=arguments.length,u=Array(o),l=0;o>l;l++)u[l]=arguments[l];u=u[0];var v=u.src,f=u.type,p=u.opt,h=u.cb,m=(p.autoplay,p.preload,p.muted,p.loop),_=p.fps,g=p.canvas,y=(p.context,p.render),b=p.element,x=b||document.createElement("video"),w=Date.now(),E=0,A=1/0,k=void 0;c?(p.muted||(k=document.createElement("audio"),p.autoplay=!1),(0,a["default"])([function(e){s["default"].video({sources:v,types:f,opt:Object.assign({},p,{muted:!0,element:x}),cb:e})},function(e){s["default"].audio({sources:v,types:f,opt:Object.assign({},p,{element:k}),cb:e})}],e)):s["default"].video({sources:v,types:f,opt:Object.assign({},p,{element:x}),cb:e})}},function(e,t,i){(function(t){"use strict";function n(){}function r(e){function i(){f.addEventListener("canplay",function(){v(null,f),v=n},!1),f.addEventListener("error",function(e){v(e),v=n},!1),f.addEventListener("readystatechange",r,!1),f.load(),r()}function r(){f.readyState>f.HAVE_FUTURE_DATA&&(v(null,f),v=n)}for(var o=arguments.length,s=Array(o>1?o-1:0),u=1;o>u;u++)s[u-1]=arguments[u];s=s[0];var d=s.sources,c=s.types,l=s.opt,v=s.cb;"function"==typeof l&&(v=l,l={}),v=v||n,l=l||{},Array.isArray(d)||(d=[d],c=[c]);var f=l.element||document.createElement(e);return l.loop&&f.setAttribute("loop",!0),l.muted&&f.setAttribute("muted","muted"),l.autoplay&&f.setAttribute("autoplay","autoplay"),l.preload&&f.setAttribute("preload",l.preload),"undefined"!=typeof l.volume&&f.setAttribute("volume",l.volume),f.setAttribute("crossorigin","anonymous"),f.setAttribute("webkit-playsinline",""),d.forEach(function(e,t){var i=c[t];f.appendChild(a(e,i))}),t.nextTick(i),f}var a=i(4);e.exports.video=r.bind(null,"video"),e.exports.audio=r.bind(null,"audio")}).call(t,i(1))},function(e,t,i){"use strict";function n(e,t){var i=document.createElement("source");return i.src=e,t||(t=r(e)),i.type=t,i}function r(e){var t=a(e);if(0===t.indexOf(".")&&(t=s[t.substring(1).toLowerCase()]),!t)throw new TypeError("could not determine mime-type from source: "+e);return t}var a=i(6).extname,o=i(5),s={};Object.keys(o).forEach(function(e){var t=o[e];t.forEach(function(t){s[t]=e})}),e.exports=n},function(e,t){e.exports={"audio/adpcm":["adp"],"audio/basic":["au","snd"],"audio/midi":["mid","midi","kar","rmi"],"audio/mp4":["mp4a","m4a"],"audio/mpeg":["mpga","mp2","mp2a","mp3","m2a","m3a"],"audio/ogg":["oga","ogg","spx"],"audio/s3m":["s3m"],"audio/silk":["sil"],"audio/vnd.dece.audio":["uva","uvva"],"audio/vnd.digital-winds":["eol"],"audio/vnd.dra":["dra"],"audio/vnd.dts":["dts"],"audio/vnd.dts.hd":["dtshd"],"audio/vnd.lucent.voice":["lvp"],"audio/vnd.ms-playready.media.pya":["pya"],"audio/vnd.nuera.ecelp4800":["ecelp4800"],"audio/vnd.nuera.ecelp7470":["ecelp7470"],"audio/vnd.nuera.ecelp9600":["ecelp9600"],"audio/vnd.rip":["rip"],"audio/webm":["weba"],"audio/x-aac":["aac"],"audio/x-aiff":["aif","aiff","aifc"],"audio/x-caf":["caf"],"audio/x-flac":["flac"],"audio/x-matroska":["mka"],"audio/x-mpegurl":["m3u"],"audio/x-ms-wax":["wax"],"audio/x-ms-wma":["wma"],"audio/x-pn-realaudio":["ram","ra"],"audio/x-pn-realaudio-plugin":["rmp"],"audio/x-wav":["wav"],"audio/xm":["xm"],"video/3gpp":["3gp"],"video/3gpp2":["3g2"],"video/h261":["h261"],"video/h263":["h263"],"video/h264":["h264"],"video/jpeg":["jpgv"],"video/jpm":["jpm","jpgm"],"video/mj2":["mj2","mjp2"],"video/mp2t":["ts"],"video/mp4":["mp4","mp4v","mpg4"],"video/mpeg":["mpeg","mpg","mpe","m1v","m2v"],"video/ogg":["ogv"],"video/quicktime":["qt","mov"],"video/vnd.dece.hd":["uvh","uvvh"],"video/vnd.dece.mobile":["uvm","uvvm"],"video/vnd.dece.pd":["uvp","uvvp"],"video/vnd.dece.sd":["uvs","uvvs"],"video/vnd.dece.video":["uvv","uvvv"],"video/vnd.dvb.file":["dvb"],"video/vnd.fvt":["fvt"],"video/vnd.mpegurl":["mxu","m4u"],"video/vnd.ms-playready.media.pyv":["pyv"],"video/vnd.uvvu.mp4":["uvu","uvvu"],"video/vnd.vivo":["viv"],"video/webm":["webm"],"video/x-f4v":["f4v"],"video/x-fli":["fli"],"video/x-flv":["flv"],"video/x-m4v":["m4v"],"video/x-matroska":["mkv","mk3d","mks"],"video/x-mng":["mng"],"video/x-ms-asf":["asf","asx"],"video/x-ms-vob":["vob"],"video/x-ms-wm":["wm"],"video/x-ms-wmv":["wmv"],"video/x-ms-wmx":["wmx"],"video/x-ms-wvx":["wvx"],"video/x-msvideo":["avi"],"video/x-sgi-movie":["movie"],"video/x-smv":["smv"]}},function(e,t,i){(function(e){function i(e,t){for(var i=0,n=e.length-1;n>=0;n--){var r=e[n];"."===r?e.splice(n,1):".."===r?(e.splice(n,1),i++):i&&(e.splice(n,1),i--)}if(t)for(;i--;i)e.unshift("..");return e}function n(e,t){if(e.filter)return e.filter(t);for(var i=[],n=0;n<e.length;n++)t(e[n],n,e)&&i.push(e[n]);return i}var r=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,a=function(e){return r.exec(e).slice(1)};t.resolve=function(){for(var t="",r=!1,a=arguments.length-1;a>=-1&&!r;a--){var o=a>=0?arguments[a]:e.cwd();if("string"!=typeof o)throw new TypeError("Arguments to path.resolve must be strings");o&&(t=o+"/"+t,r="/"===o.charAt(0))}return t=i(n(t.split("/"),function(e){return!!e}),!r).join("/"),(r?"/":"")+t||"."},t.normalize=function(e){var r=t.isAbsolute(e),a="/"===o(e,-1);return e=i(n(e.split("/"),function(e){return!!e}),!r).join("/"),e||r||(e="."),e&&a&&(e+="/"),(r?"/":"")+e},t.isAbsolute=function(e){return"/"===e.charAt(0)},t.join=function(){var e=Array.prototype.slice.call(arguments,0);return t.normalize(n(e,function(e,t){if("string"!=typeof e)throw new TypeError("Arguments to path.join must be strings");return e}).join("/"))},t.relative=function(e,i){function n(e){for(var t=0;t<e.length&&""===e[t];t++);for(var i=e.length-1;i>=0&&""===e[i];i--);return t>i?[]:e.slice(t,i-t+1)}e=t.resolve(e).substr(1),i=t.resolve(i).substr(1);for(var r=n(e.split("/")),a=n(i.split("/")),o=Math.min(r.length,a.length),s=o,u=0;o>u;u++)if(r[u]!==a[u]){s=u;break}for(var d=[],u=s;u<r.length;u++)d.push("..");return d=d.concat(a.slice(s)),d.join("/")},t.sep="/",t.delimiter=":",t.dirname=function(e){var t=a(e),i=t[0],n=t[1];return i||n?(n&&(n=n.substr(0,n.length-1)),i+n):"."},t.basename=function(e,t){var i=a(e)[2];return t&&i.substr(-1*t.length)===t&&(i=i.substr(0,i.length-t.length)),i},t.extname=function(e){return a(e)[3]};var o="b"==="ab".substr(-1)?function(e,t,i){return e.substr(t,i)}:function(e,t,i){return 0>t&&(t=e.length+t),e.substr(t,i)}}).call(t,i(1))},function(e,t,i){(function(t){e.exports=function(e,i){function n(e){function n(){i&&i(e,a),i=null}u?t.nextTick(n):n()}function r(e,t,i){a[e]=i,(0===--o||t)&&n(t)}var a,o,s,u=!0;Array.isArray(e)?(a=[],o=e.length):(s=Object.keys(e),a={},o=s.length),o?s?s.forEach(function(t){e[t](function(e,i){r(t,e,i)})}):e.forEach(function(e,t){e(function(e,i){r(t,e,i)})}):n(null),u=!1}}).call(t,i(1))}]);